<!DOCTYPE html>
<html>

<head>
  <link href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css" rel="stylesheet">
  <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/dexie@latest/dist/dexie.js"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <style>
    body, html {
      margin:0px;
    }
    :root {
      --mdc-theme-primary: #D50032;
    }
    .template {
      display:none;
    }
  </style>
</head>

<body>
  <aside class="mdc-drawer mdc-drawer--modal" data-mdc-auto-init="MDCDrawer">
    <div class="mdc-drawer__content">
      <nav class="mdc-list">
        <a class="mdc-list-item mdc-list-item--activated" href="#weather" aria-current="page">
          <i class="material-icons mdc-list-item__graphic" aria-hidden="true">cloud</i>
        </a>
        <a class="mdc-list-item" href="#recent">
          <i class="material-icons mdc-list-item__graphic" aria-hidden="true">star</i>
        </a>
        <a class="mdc-list-item" href="#stations">
          <i class="material-icons mdc-list-item__graphic" aria-hidden="true">menu</i>
        </a>
      </nav>
    </div>
  </aside>

  <div class="mdc-drawer-scrim"></div>

  <header class="mdc-top-app-bar">
    <div class="mdc-top-app-bar__row">
      <section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-start">
        <button class="material-icons mdc-top-app-bar__navigation-icon mdc-icon-button">menu</button>
        <span class="mdc-top-app-bar__title">Transit/Weather Tracker</span>
      </section>
      <section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-end" role="toolbar">
        <button class="material-icons mdc-top-app-bar__action-item mdc-icon-button" aria-label="Download">file_download</button>
        <button class="material-icons mdc-top-app-bar__action-item mdc-icon-button" aria-label="Print this page">print</button>
        <button class="material-icons mdc-top-app-bar__action-item mdc-icon-button" aria-label="Bookmark this page">bookmark</button>
      </section>
    </div>
  </header>

  <div class="mdc-drawer-app-content mdc-top-app-bar--fixed-adjust" id="content">
    <div class="content" id="weather">
      <button class="mdc-button mdc-button--raised" id="location">  <span class="mdc-button__ripple"></span>Get Location</button>
      
    </div>
    <div class="content" id="recent">
      
    </div>
    <div class="content" id="stations">
      <ul class="routes">
        
      </ul>
      
    </div>
  </div>
  <script src="https://unpkg.com/dexie@latest/dist/dexie.js"></script>
  <script>
    var db = new Dexie("ttapp");
    db.version(1).stores({
      history: '++id',
      favorites: 'stop_id'
    });
    db.history.put({
      "opened": new Date()
    });
  </script>
  <script>
    window.mdc.autoInit();
     // mdc.drawer.MDCDrawer.attachTo(document.querySelector('.mdc-drawer')); 
    const drawer = document.querySelector('.mdc-drawer').MDCDrawer;
     // console.log(drawer);
     // open drawer on nav icon
    document.getElementsByClassName("mdc-top-app-bar__navigation-icon")[0].addEventListener("click", function() {
      drawer.open = true;
    });
    function hideScreens() {
      $(".content").hide();
    }
     // close drawer on selection
    let navs = document.getElementsByClassName("mdc-list-item");
    for(let i = 0; i < navs.length; i++) {
      navs[i].addEventListener("click", function() {
        drawer.open = false;
        hideScreens();
        var target = $(this).attr("href");
        $(target).show();
      })
    };
    let corsanywhere = "https://cors-anywhere.herokuapp.com/"
    var trainarrivalendpoint = corsanywhere + "http://lapi.transitchicago.com/api/1.0/ttarrivals.aspx?outputType=JSON&key="
    var trainlocationendpoint = corsanywhere + "http://lapi.transitchicago.com/api/1.0/ttpositions.aspx?outputType=JSON&key="
    var weatherendpoint = corsanywhere +"http://api.openweathermap.org/data/2.5/weather?lat="
    var trainkey = "a84a005d40d24debb86f294dad996767"
    var weatherkey = "33b276c7eacaa52ce3cb19f57f583ae1"
    function currentWeather(position) {
      weatherendpoint = weatherendpoint + position.coords.latitude + "&lon=" + position.coords.longitude + "&appid=" + weatherkey;
      $.get(weatherendpoint, function(res) {
        
       $("#weather").append('<h6 class="mdc-typography--subtitle1">Current Weather is: '+ res.weather[0].main + '</h6>');
      })
    }
    function getstations(res) {
      $.each(res, function(i, v) {
        
      })
    }
    document.getElementById("location").addEventListener("click", function() {
      if(navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(currentWeather)
      }
      else {
        $("#weather").append("<div><div id=\"alert-dialog\" class=\"mdc-dialog\" role=\"alertdialog\" aria-modal=\"true\" aria-describedby=\"alert-dialog-description\"><div class=\"mdc-dialog__scrim\"></div><div class=\"mdc-dialog__container\"><div class=\"mdc-dialog__surface\"><section id=\"alert-dialog-description\" class=\"mdc-dialog__content\"><p>Location Not Available, Try again?</p></section><footer class=\"mdc-dialog__actions\"><button type=\"button\" class=\"mdc-button mdc-dialog__button mdc-ripple-upgraded\" data-mdc-dialog-action=\"close\">Cancel</button><button type=\"button\" class=\"mdc-button mdc-dialog__button mdc-ripple-upgraded\" data-mdc-dialog-action=\"accept\">Try Again</button></footer></div></div></div></div>")
      }
    })
    let stations = document.getElementById("stations");
    let routes = ["Red Line", "Blue Line", "Green Line", "Purple Line", "Pink Line", "Brown Line", "Yellow Line", "Brown Line"]
    
    stations.addEventListener("click", function() {
      for(let i =0;i<routes.length;i++) {
        $(".routes").append()
      }
      let busroutes = busrouteendpoint + buskey + "&format=json"
      $.get(busroutes, function(res){
        $.each(res, function(i, v) {
          $(".routes").append()
        })
      })
    })
  </script>


</body>

</html>